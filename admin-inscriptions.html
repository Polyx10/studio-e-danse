<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio E - Gestion des Inscriptions</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .filters {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .filters input {
            padding: 10px 15px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            flex: 1;
        }
        
        .filters button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .stats {
            padding: 20px 30px;
            display: flex;
            gap: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .stat-card {
            flex: 1;
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-card .label {
            font-size: 14px;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .table-container {
            padding: 30px;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: #f8f9fa;
        }
        
        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            font-size: 14px;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            font-size: 14px;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        .btn-pdf {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
        }
        
        .btn-pdf:hover {
            background: #218838;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #6c757d;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            margin: 20px;
            border-radius: 6px;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ­ Studio E - Gestion des Inscriptions</h1>
            <p>Interface de consultation et export PDF</p>
        </div>
        
        <div class="filters">
            <input type="text" id="searchInput" placeholder="Rechercher par nom d'Ã©lÃ¨ve...">
            <button onclick="loadInscriptions()">ðŸ”„ Actualiser</button>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="number" id="totalCount">0</div>
                <div class="label">Total inscriptions</div>
            </div>
            <div class="stat-card">
                <div class="number" id="todayCount">0</div>
                <div class="label">Aujourd'hui</div>
            </div>
        </div>
        
        <div class="table-container">
            <div id="loading" class="loading">Chargement des inscriptions...</div>
            <div id="error" class="error" style="display: none;"></div>
            <table id="inscriptionsTable" style="display: none;">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Ã‰lÃ¨ve</th>
                        <th>Ã‚ge</th>
                        <th>Responsable</th>
                        <th>Cours</th>
                        <th>Tarif</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="inscriptionsBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Configuration Supabase
        const SUPABASE_URL = 'https://homtdfprbbjgnkikqesq.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhvbXRkZnByYmJqZ25raWtxZXNxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY0ODMzNDcsImV4cCI6MjA4MjA1OTM0N30.yBWOhFZqNCAuYEDLkvqwTPvz1MICNqajaMM86U3MSMk';
        
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);
        
        let allInscriptions = [];
        
        // DonnÃ©es des cours (copiÃ© depuis planning-data.ts)
        const planningCours = [
            { id: "lun-1", jour: "Lundi", nom: "Classique ADO 1", horaire: "17h45-19h15", professeur: "Romane", salle: "LDN" },
            { id: "lun-2", jour: "Lundi", nom: "BAS", horaire: "19h15-20h15", professeur: "Romane", salle: "LDN" },
            { id: "lun-3", jour: "Lundi", nom: "Classique Adulte Inter", horaire: "20h15-21h45", professeur: "Jeanette", salle: "TV" },
            { id: "mar-1", jour: "Mardi", nom: "Jazz Danse Etude", horaire: "15h45-17h30", professeur: "Audrey", salle: "TV" },
            { id: "mar-2", jour: "Mardi", nom: "Classique ADO 2", horaire: "17h45-19h15", professeur: "Jeanette", salle: "LDN" },
            { id: "mar-3", jour: "Mardi", nom: "Jazz ADO", horaire: "17h45-19h15", professeur: "Audrey", salle: "TV" },
            { id: "mar-4", jour: "Mardi", nom: "BAS", horaire: "19h15-20h15", professeur: "Jeanette", salle: "LDN" },
            { id: "mar-5", jour: "Mardi", nom: "Jazz Adulte Debutant", horaire: "19h15-20h30", professeur: "Audrey", salle: "TV" },
            { id: "mar-6", jour: "Mardi", nom: "Classique Adulte Inter", horaire: "20h15-21h45", professeur: "Jeanette", salle: "LDN" },
            { id: "mar-7", jour: "Mardi", nom: "Jazz Adulte Inter", horaire: "20h30-21h45", professeur: "Audrey", salle: "TV" },
            { id: "mer-1", jour: "Mercredi", nom: "Eveil", horaire: "10h15-11h00", professeur: "Aymeric", salle: "LDN" },
            { id: "mer-2", jour: "Mercredi", nom: "Initiation", horaire: "11h00-12h00", professeur: "Aymeric", salle: "LDN" },
            { id: "mer-3", jour: "Mercredi", nom: "Classique Initiation", horaire: "13h30-14h30", professeur: "Jeanette", salle: "LDN" },
            { id: "mer-4", jour: "Mercredi", nom: "Jazz KID", horaire: "14h00-15h15", professeur: "Audrey", salle: "TV" },
            { id: "mer-5", jour: "Mercredi", nom: "Classique Enfant 1", horaire: "14h30-15h30", professeur: "Jeanette", salle: "LDN" },
            { id: "mer-6", jour: "Mercredi", nom: "Jazz ADO", horaire: "15h15-16h45", professeur: "Audrey", salle: "TV" },
            { id: "mer-7", jour: "Mercredi", nom: "Eveil", horaire: "15h45-16h30", professeur: "Jeanette", salle: "LDN" },
            { id: "mer-8", jour: "Mercredi", nom: "Classique Enfant 2", horaire: "16h30-18h00", professeur: "Jeanette", salle: "LDN" },
            { id: "mer-9", jour: "Mercredi", nom: "Jazz Jeune Adulte Inter", horaire: "17h00-18h30", professeur: "Audrey", salle: "TV" },
            { id: "mer-10", jour: "Mercredi", nom: "Classique ADO 1", horaire: "18h00-19h30", professeur: "Jeanette", salle: "LDN" },
            { id: "mer-11", jour: "Mercredi", nom: "Jazz Jeune Adulte Avance", horaire: "18h30-20h00", professeur: "Audrey", salle: "TV" },
            { id: "mer-12", jour: "Mercredi", nom: "BAS", horaire: "20h00-21h00", professeur: "Jeanette", salle: "LDN" },
            { id: "mer-13", jour: "Mercredi", nom: "Jazz Adulte Avance", horaire: "20h00-21h30", professeur: "Audrey", salle: "TV" },
            { id: "jeu-1", jour: "Jeudi", nom: "Jazz KID", horaire: "17h30-18h45", professeur: "Audrey", salle: "LDN" },
            { id: "jeu-2", jour: "Jeudi", nom: "Technique KID-ADO", horaire: "17h45-19h15", professeur: "Titouan", salle: "TV" },
            { id: "jeu-3", jour: "Jeudi", nom: "Concours Youth", horaire: "19h00-19h45", professeur: "Titouan", salle: "TV" },
            { id: "jeu-4", jour: "Jeudi", nom: "Classique Adulte Avance", horaire: "19h45-21h15", professeur: "Aymeric", salle: "LDN" },
            { id: "jeu-5", jour: "Jeudi", nom: "Concours Jazz Adulte", horaire: "20h00-21h00", professeur: "Titouan", salle: "TV" },
            { id: "ven-1", jour: "Vendredi", nom: "BAS", horaire: "12h30-13h30", professeur: "Jeanette", salle: "LDN" },
            { id: "ven-2", jour: "Vendredi", nom: "Jazz Danse Etude", horaire: "15h45-17h30", professeur: "Audrey", salle: "TV" },
            { id: "ven-3", jour: "Vendredi", nom: "Classique ADO 2", horaire: "17h45-19h15", professeur: "Jeanette", salle: "LDN" },
            { id: "ven-4", jour: "Vendredi", nom: "Jazz Jeune Adulte Inter", horaire: "17h30-19h00", professeur: "Audrey", salle: "TV" },
            { id: "ven-5", jour: "Vendredi", nom: "Classique Adulte Debutant", horaire: "19h15-20h30", professeur: "Jeanette", salle: "LDN" },
            { id: "ven-6", jour: "Vendredi", nom: "Jazz Jeune Adulte Avance", horaire: "19h00-20h30", professeur: "Audrey", salle: "TV" },
            { id: "ven-7", jour: "Vendredi", nom: "Contemporain Adulte", horaire: "20h30-22h00", professeur: "Audrey", salle: "TV" },
            { id: "sam-1", jour: "Samedi", nom: "Baby danse", horaire: "9h30-10h00", professeur: "Audrey", salle: "TV" },
            { id: "sam-2", jour: "Samedi", nom: "Classique Initiation", horaire: "10h00-11h00", professeur: "Jeanette", salle: "AC" },
            { id: "sam-3", jour: "Samedi", nom: "Jazz KID Concours", horaire: "10h00-11h00", professeur: "Titouan", salle: "LDN" },
            { id: "sam-4", jour: "Samedi", nom: "Jazz Initiation", horaire: "10h00-11h00", professeur: "Audrey", salle: "TV" },
            { id: "sam-5", jour: "Samedi", nom: "Classique Enfant 1 Enfant 2", horaire: "11h00-12h15", professeur: "Jeanette", salle: "AC" },
            { id: "sam-6", jour: "Samedi", nom: "Jazz ADO Concours", horaire: "11h00-12h00", professeur: "Titouan", salle: "LDN" },
            { id: "sam-7", jour: "Samedi", nom: "Eveil", horaire: "11h00-11h45", professeur: "Audrey", salle: "TV" },
            { id: "sam-8", jour: "Samedi", nom: "Classique Adulte Debutant", horaire: "12h15-13h30", professeur: "Jeanette", salle: "AC" },
            { id: "sam-9", jour: "Samedi", nom: "Jazz Adulte Inter", horaire: "12h00-13h30", professeur: "Audrey", salle: "TV" },
            { id: "sam-10", jour: "Samedi", nom: "Classique Adulte Avance", horaire: "13h45-15h15", professeur: "Jeanette", salle: "LDN" },
            { id: "sam-11", jour: "Samedi", nom: "Contemporain ADO", horaire: "15h15-16h45", professeur: "Jeanette", salle: "LDN" }
        ];
        
        function getCoursDetails(courseId) {
            return planningCours.find(c => c.id === courseId) || { nom: courseId, horaire: '', professeur: '', jour: '' };
        }
        
        // Calculer l'Ã¢ge
        function calculateAge(birthDate) {
            if (!birthDate) return 0;
            
            let birth;
            // GÃ©rer les deux formats possibles: DD/MM/YYYY ou YYYY-MM-DD
            if (birthDate.includes('/')) {
                const parts = birthDate.split('/');
                birth = new Date(parts[2], parts[1] - 1, parts[0]);
            } else if (birthDate.includes('-')) {
                birth = new Date(birthDate);
            } else {
                return 0;
            }
            
            const today = new Date();
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            return age;
        }
        
        // Charger les inscriptions
        async function loadInscriptions() {
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('error').style.display = 'none';
                document.getElementById('inscriptionsTable').style.display = 'none';
                
                const { data, error } = await supabaseClient
                    .from('inscriptions')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                allInscriptions = data;
                displayInscriptions(data);
                updateStats(data);
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('inscriptionsTable').style.display = 'table';
            } catch (error) {
                console.error('Erreur:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').textContent = 'Erreur de chargement: ' + error.message;
                document.getElementById('error').style.display = 'block';
            }
        }
        
        // Afficher les inscriptions
        function displayInscriptions(inscriptions) {
            const tbody = document.getElementById('inscriptionsBody');
            tbody.innerHTML = '';
            
            inscriptions.forEach(inscription => {
                const row = document.createElement('tr');
                const date = new Date(inscription.created_at).toLocaleDateString('fr-FR');
                const age = calculateAge(inscription.student_birth_date);
                const coursCount = inscription.selected_courses.length;
                
                row.innerHTML = `
                    <td>${date}</td>
                    <td><strong>${inscription.student_name}</strong></td>
                    <td>${age} ans</td>
                    <td>${inscription.responsable1_name}</td>
                    <td>${coursCount} cours</td>
                    <td><strong>${inscription.tarif_total} â‚¬</strong></td>
                    <td>
                        <button class="btn-pdf" onclick="generatePDF('${inscription.id}')">
                            ðŸ“„ PDF
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Mettre Ã  jour les statistiques
        function updateStats(inscriptions) {
            document.getElementById('totalCount').textContent = inscriptions.length;
            
            const today = new Date().toDateString();
            const todayCount = inscriptions.filter(i => 
                new Date(i.created_at).toDateString() === today
            ).length;
            document.getElementById('todayCount').textContent = todayCount;
        }
        
        // Recherche
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const search = e.target.value.toLowerCase();
            const filtered = allInscriptions.filter(i => 
                i.student_name.toLowerCase().includes(search) ||
                i.responsable1_name.toLowerCase().includes(search)
            );
            displayInscriptions(filtered);
        });
        
        // GÃ©nÃ©rer le PDF - Version esthÃ©tique et professionnelle
        function generatePDF(inscriptionId) {
            const inscription = allInscriptions.find(i => i.id === inscriptionId);
            if (!inscription) return;
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const pageWidth = 210;
            const margin = 15;
            const contentWidth = pageWidth - (2 * margin);
            const lineHeight = 6;
            
            // Couleurs
            const primaryColor = [102, 126, 234]; // Violet Studio E
            const lightBg = [248, 249, 250];
            const darkText = [45, 52, 54];
            const lightText = [108, 117, 125];
            
            // Fonction pour dessiner un encadrÃ© avec titre
            function drawSection(title, yPos, height = null) {
                // Fond colorÃ© pour le titre
                doc.setFillColor(...primaryColor);
                doc.rect(margin, yPos, contentWidth, 8, 'F');
                
                // Titre en blanc
                doc.setFontSize(11);
                doc.setTextColor(255, 255, 255);
                doc.setFont(undefined, 'bold');
                doc.text(title, margin + 3, yPos + 5.5);
                
                // Bordure de la section
                if (height) {
                    doc.setDrawColor(200, 200, 200);
                    doc.setLineWidth(0.3);
                    doc.rect(margin, yPos, contentWidth, height);
                }
                
                return yPos + 8;
            }
            
            // En-tÃªte avec dÃ©gradÃ© visuel
            doc.setFillColor(...primaryColor);
            doc.rect(0, 0, pageWidth, 35, 'F');
            
            doc.setFontSize(20);
            doc.setTextColor(255, 255, 255);
            doc.setFont(undefined, 'bold');
            doc.text('STUDIO E', pageWidth/2, 12, { align: 'center' });
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text('Ã‰cole de Danse', pageWidth/2, 18, { align: 'center' });
            
            doc.setFontSize(13);
            doc.setFont(undefined, 'bold');
            doc.text('FORMULAIRE D\'INSCRIPTION EN LIGNE', pageWidth/2, 26, { align: 'center' });
            
            doc.setFontSize(8);
            doc.setFont(undefined, 'normal');
            const dateInscription = new Date(inscription.created_at).toLocaleDateString('fr-FR');
            doc.text(`ReÃ§u le ${dateInscription}`, pageWidth/2, 31, { align: 'center' });
            
            let y = 42;
            
            // === SECTION 1: INFORMATIONS Ã‰LÃˆVE ===
            y = drawSection('INFORMATIONS Ã‰LÃˆVE', y);
            y += 5;
            
            doc.setFontSize(10);
            doc.setTextColor(...darkText);
            doc.setFont(undefined, 'normal');
            
            // Grille Ã  2 colonnes
            const col1 = margin + 3;
            const col2 = margin + contentWidth/2 + 3;
            
            doc.setFont(undefined, 'bold');
            doc.text('AdhÃ©rent prÃ©cÃ©dent:', col1, y);
            doc.setFont(undefined, 'normal');
            doc.text(inscription.adherent_precedent ? 'Oui' : 'Non', col1 + 40, y);
            y += lineHeight;
            
            doc.setFont(undefined, 'bold');
            doc.text('Nom et prÃ©nom:', col1, y);
            doc.setFont(undefined, 'normal');
            doc.text(inscription.student_name, col1 + 40, y);
            y += lineHeight;
            
            doc.setFont(undefined, 'bold');
            doc.text('Sexe:', col1, y);
            doc.setFont(undefined, 'normal');
            doc.text(inscription.student_gender === 'F' ? 'FÃ©minin' : 'Masculin', col1 + 40, y);
            
            doc.setFont(undefined, 'bold');
            doc.text('Ã‚ge:', col2, y);
            doc.setFont(undefined, 'normal');
            doc.text(`${calculateAge(inscription.student_birth_date)} ans`, col2 + 15, y);
            y += lineHeight;
            
            doc.setFont(undefined, 'bold');
            doc.text('Date de naissance:', col1, y);
            doc.setFont(undefined, 'normal');
            doc.text(inscription.student_birth_date, col1 + 40, y);
            y += lineHeight + 2;
            
            if (inscription.student_address) {
                doc.setFont(undefined, 'bold');
                doc.text('Adresse:', col1, y);
                doc.setFont(undefined, 'normal');
                doc.text(inscription.student_address, col1 + 40, y);
                y += lineHeight;
                doc.text(`${inscription.student_postal_code} ${inscription.student_city}`, col1 + 40, y);
                y += lineHeight;
            }
            
            if (inscription.student_phone || inscription.student_email) {
                if (inscription.student_phone) {
                    doc.setFont(undefined, 'bold');
                    doc.text('TÃ©lÃ©phone:', col1, y);
                    doc.setFont(undefined, 'normal');
                    doc.text(inscription.student_phone, col1 + 40, y);
                    y += lineHeight;
                }
                if (inscription.student_email) {
                    doc.setFont(undefined, 'bold');
                    doc.text('Email:', col1, y);
                    doc.setFont(undefined, 'normal');
                    doc.text(inscription.student_email, col1 + 40, y);
                    y += lineHeight;
                }
            }
            
            y += 8;
            
            // === SECTION 2: RESPONSABLES LÃ‰GAUX ===
            y = drawSection('RESPONSABLES LÃ‰GAUX', y);
            y += 5;
            
            doc.setFontSize(10);
            doc.setTextColor(...darkText);
            
            // Responsable 1
            doc.setFillColor(248, 249, 250);
            doc.rect(col1 - 2, y - 3, contentWidth/2 - 4, inscription.responsable2_name ? 20 : 20, 'F');
            
            doc.setFont(undefined, 'bold');
            doc.setFontSize(9);
            doc.text('Responsable 1', col1, y);
            y += lineHeight;
            
            doc.setFont(undefined, 'normal');
            doc.setFontSize(8);
            doc.text(`Nom: ${inscription.responsable1_name}`, col1, y);
            y += lineHeight - 1;
            doc.text(`TÃ©l: ${inscription.responsable1_phone}`, col1, y);
            y += lineHeight - 1;
            doc.text(`Email: ${inscription.responsable1_email}`, col1, y);
            
            // Responsable 2
            if (inscription.responsable2_name) {
                let y2 = y - 18;
                doc.setFillColor(248, 249, 250);
                doc.rect(col2 - 2, y2 - 3, contentWidth/2 - 4, 20, 'F');
                
                doc.setFont(undefined, 'bold');
                doc.setFontSize(9);
                doc.text('Responsable 2', col2, y2);
                y2 += lineHeight;
                
                doc.setFont(undefined, 'normal');
                doc.setFontSize(8);
                doc.text(`Nom: ${inscription.responsable2_name}`, col2, y2);
                y2 += lineHeight - 1;
                if (inscription.responsable2_phone) {
                    doc.text(`TÃ©l: ${inscription.responsable2_phone}`, col2, y2);
                    y2 += lineHeight - 1;
                }
                if (inscription.responsable2_email) {
                    doc.text(`Email: ${inscription.responsable2_email}`, col2, y2);
                }
            }
            
            y += lineHeight + 8;
            
            // === SECTION 3: COURS SÃ‰LECTIONNÃ‰S ===
            y = drawSection('COURS SÃ‰LECTIONNÃ‰S', y);
            y += 5;
            
            doc.setFontSize(10);
            doc.setTextColor(...darkText);
            doc.setFont(undefined, 'normal');
            
            inscription.selected_courses.forEach((courseId, index) => {
                const cours = getCoursDetails(courseId);
                
                // Fond alternÃ© pour chaque cours
                if (index % 2 === 0) {
                    doc.setFillColor(252, 252, 253);
                    doc.rect(col1 - 2, y - 3, contentWidth - 2, 9, 'F');
                }
                
                doc.setFont(undefined, 'bold');
                doc.text(`${cours.nom}`, col1, y);
                doc.setFont(undefined, 'normal');
                doc.setFontSize(8);
                doc.setTextColor(...lightText);
                doc.text(`${cours.jour} ${cours.horaire} â€¢ ${cours.professeur} â€¢ ${cours.salle}`, col1, y + 4);
                doc.setFontSize(9);
                doc.setTextColor(...darkText);
                y += 10;
            });
            
            y += 2;
            
            // Options spÃ©ciales avec badges
            if (inscription.danse_etudes_option !== '0' || inscription.concours_on_stage || inscription.concours_classes || inscription.tarif_reduit) {
                doc.setFontSize(8);
                let badgeY = y;
                
                if (inscription.danse_etudes_option !== '0') {
                    doc.setFillColor(255, 243, 205);
                    doc.setDrawColor(255, 193, 7);
                    doc.roundedRect(col1, badgeY - 3, 45, 5, 1, 1, 'FD');
                    doc.setTextColor(180, 130, 0);
                    doc.text(`Danse Ã‰tudes ${inscription.danse_etudes_option}`, col1 + 2, badgeY);
                    badgeY += 7;
                }
                
                if (inscription.concours_on_stage) {
                    doc.setFillColor(220, 237, 255);
                    doc.setDrawColor(33, 150, 243);
                    doc.roundedRect(col1, badgeY - 3, 35, 5, 1, 1, 'FD');
                    doc.setTextColor(13, 71, 161);
                    doc.text('On Stage', col1 + 2, badgeY);
                    badgeY += 7;
                }
                
                if (inscription.concours_classes) {
                    doc.setFillColor(220, 237, 255);
                    doc.setDrawColor(33, 150, 243);
                    doc.roundedRect(col1, badgeY - 3, 40, 5, 1, 1, 'FD');
                    doc.setTextColor(13, 71, 161);
                    doc.text('Classes Concours', col1 + 2, badgeY);
                    badgeY += 7;
                }
                
                if (inscription.tarif_reduit) {
                    doc.setFillColor(200, 230, 201);
                    doc.setDrawColor(76, 175, 80);
                    doc.roundedRect(col1, badgeY - 3, 25, 5, 1, 1, 'FD');
                    doc.setTextColor(27, 94, 32);
                    doc.text('Tarif rÃ©duit', col1 + 2, badgeY);
                }
                
                y = badgeY + 5;
            }
            
            y += 8;
            
            // === SECTION 4: TARIFICATION & OPTIONS ===
            y = drawSection('TARIFICATION & OPTIONS', y);
            y += 5;
            
            // EncadrÃ© tarification
            doc.setFillColor(248, 249, 250);
            doc.rect(col1 - 2, y - 3, contentWidth/2 - 4, 25, 'F');
            
            doc.setFontSize(10);
            doc.setTextColor(...darkText);
            doc.setFont(undefined, 'normal');
            
            doc.text(`Cours:`, col1, y);
            doc.text(`${inscription.tarif_cours} â‚¬`, col1 + 50, y);
            y += lineHeight;
            doc.text(`AdhÃ©sion:`, col1, y);
            doc.text(`${inscription.adhesion} â‚¬`, col1 + 50, y);
            y += lineHeight;
            doc.text(`Licence FFD:`, col1, y);
            doc.text(`${inscription.licence_ffd} â‚¬`, col1 + 50, y);
            y += lineHeight + 2;
            
            doc.setFillColor(...primaryColor);
            doc.rect(col1 - 2, y - 4, contentWidth/2 - 4, 7, 'F');
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(255, 255, 255);
            doc.text(`TOTAL: ${inscription.tarif_total} â‚¬`, col1, y);
            
            // Options Ã  droite
            let yOpt = y - 21;
            doc.setFontSize(8);
            doc.setTextColor(...darkText);
            doc.setFont(undefined, 'normal');
            doc.text(`Spectacle: ${inscription.participation_spectacle}`, col2, yOpt);
            yOpt += lineHeight - 1;
            doc.text(`Costumes: ${inscription.nombre_costumes}`, col2, yOpt);
            yOpt += lineHeight - 1;
            doc.text(`Droit image: ${inscription.droit_image}`, col2, yOpt);
            yOpt += lineHeight - 1;
            if (inscription.mode_paiement && inscription.mode_paiement.length > 0) {
                const modes = Array.isArray(inscription.mode_paiement) 
                    ? inscription.mode_paiement.join(', ') 
                    : inscription.mode_paiement;
                doc.text(`Paiement: ${modes}`, col2, yOpt);
                yOpt += lineHeight - 1;
            }
            doc.text(`Versements: ${inscription.nombre_versements}`, col2, yOpt);
            
            y += 12;
            
            // === SECTION 5: VALIDATION ===
            y = drawSection('VALIDATION & SIGNATURE', y);
            y += 5;
            
            doc.setFontSize(10);
            doc.setTextColor(...darkText);
            doc.setFont(undefined, 'normal');
            
            // RÃ¨glement intÃ©rieur
            const accepte = inscription.accept_rules;
            doc.setFillColor(accepte ? 200 : 255, accepte ? 230 : 205, accepte ? 201 : 210);
            doc.rect(col1 - 2, y - 3, contentWidth - 2, 7, 'F');
            doc.setFont(undefined, 'bold');
            doc.text(`RÃ¨glement intÃ©rieur: ${accepte ? 'âœ“ ACCEPTÃ‰' : 'âœ— NON ACCEPTÃ‰'}`, col1, y);
            y += 8;
            
            // Signature
            doc.setFont(undefined, 'bold');
            doc.text('Signature:', col1, y);
            y += lineHeight;
            doc.setFont(undefined, 'italic');
            doc.setFontSize(11);
            doc.text(inscription.signature_name, col1 + 5, y);
            y += lineHeight;
            doc.setFont(undefined, 'normal');
            doc.setFontSize(8);
            doc.setTextColor(...lightText);
            doc.text(`SignÃ© le ${dateInscription}`, col1 + 5, y);
            
            // Pied de page
            doc.setFontSize(8);
            doc.setTextColor(150, 150, 150);
            doc.text('Studio E - Ã‰cole de Danse', pageWidth/2, 285, { align: 'center' });
            doc.text('54 rue SÃ©bastopol, 29200 Brest', pageWidth/2, 290, { align: 'center' });
            
            // TÃ©lÃ©charger
            const fileName = `Inscription_${inscription.student_name.replace(/\s+/g, '_')}_${dateInscription.replace(/\//g, '-')}.pdf`;
            doc.save(fileName);
        }
        
        // Charger au dÃ©marrage
        loadInscriptions();
    </script>
</body>
</html>
